<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diners Club - Suite Integral de Gesti√≥n</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #004b8d;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-secondary: #64748b;
            
            /* Colores de Segmento */
            --color-prev: #004b8d;
            --color-med: #e67e22;
            --color-crit: #dc3545;
            --color-refin: #00897b;
            --color-reprog: #6f42c1;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-gradient);
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .main-container {
            background: var(--card-bg);
            width: 94%;
            max-width: 1600px;
            height: 90vh;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            border-top: 8px solid var(--primary);
            position: relative;
        }

        #dashboard-view {
            display: flex;
            flex-direction: column;
            height: 100%;
            animation: fadeIn 0.5s ease-out;
        }

        .dashboard-header { text-align: center; margin-bottom: 30px; }
        .dashboard-header h1 { font-size: 2.2rem; margin: 0 0 10px 0; color: var(--text-main); }
        .dashboard-header p { color: var(--text-secondary); }

        .grid-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            height: 100%;
            align-items: center;
            padding: 0 20px;
        }

        .menu-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 25px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 240px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .menu-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        .icon { font-size: 2.2rem; }
        .card-title { font-size: 1.1rem; font-weight: 700; line-height: 1.3; }
        .card-desc { font-size: 0.8rem; color: var(--text-secondary); }

        .card-prev { border-bottom: 5px solid var(--color-prev); color: var(--color-prev); }
        .card-med { border-bottom: 5px solid var(--color-med); color: var(--color-med); }
        .card-crit { border-bottom: 5px solid var(--color-crit); color: var(--color-crit); }
        .card-refin { border-bottom: 5px solid var(--color-refin); color: var(--color-refin); }
        .card-reprog { border-bottom: 5px solid var(--color-reprog); color: var(--color-reprog); }
        
        .menu-card:hover.card-prev { background-color: #f0f7ff; }
        .menu-card:hover.card-med { background-color: #fff5eb; }
        .menu-card:hover.card-crit { background-color: #fff5f5; }
        .menu-card:hover.card-refin { background-color: #e0f2f1; }
        .menu-card:hover.card-reprog { background-color: #f3e5f5; }

        #script-view {
            display: none;
            flex-direction: column;
            height: 100%;
            justify-content: space-between;
            animation: slideIn 0.3s ease-out;
        }

        .script-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .nav-controls { display: flex; gap: 10px; }

        .btn-nav {
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            border: 1px solid #cbd5e1;
            background: white;
            color: var(--text-secondary);
        }
        
        .btn-nav:hover { background: #f8fafc; color: var(--text-main); border-color: var(--text-main); }
        .btn-nav.disabled { opacity: 0.3; cursor: not-allowed; }

        .mode-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .speech-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            padding: 20px 40px;
            overflow-y: auto;
        }

        .speech-text {
            font-size: 1.6rem;
            line-height: 1.5;
            color: var(--text-main);
            text-align: left;
            width: 100%;
        }

        .data-chip {
            background-color: #e0f2fe;
            color: #0284c7;
            padding: 2px 8px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.9em;
            border: 1px dashed rgba(2, 132, 199, 0.3);
            display: inline-block;
        }

        .speech-input {
            border: none;
            border-bottom: 2px solid #ccc;
            font-size: 1rem;
            padding: 5px;
            margin: 5px 0;
            width: 100%;
            background: #fafafa;
            color: #333;
            transition: border 0.3s;
        }
        .speech-input:focus { outline: none; border-bottom: 2px solid var(--primary); background: #fff; }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            margin-top: 15px;
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        
        .form-item label { font-size: 0.8rem; font-weight: bold; color: #64748b; display: block;}

        .highlight-question {
            color: #d32f2f;
            font-weight: 800;
            border-bottom: 3px solid #ffcdd2;
            padding-bottom: 2px;
            font-size: 1.1em;
        }

        .advisor-tip {
            font-size: 1rem;
            background: #fff3cd;
            color: #856404;
            padding: 12px 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: inline-block;
            border-left: 4px solid #ffc107;
            font-weight: 500;
        }

        .info-list {
            background-color: #f1f8e9;
            border-left: 5px solid #8bc34a;
            padding: 15px 20px;
            margin-top: 15px;
            border-radius: 4px;
            font-size: 1.1rem;
        }
        .info-list ul { margin: 0; padding-left: 20px; }
        .info-list li { margin-bottom: 10px; }

        .actions-area {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            width: 100%;
            padding: 0 40px 20px 40px;
        }

        .action-btn {
            padding: 20px 25px;
            font-size: 1.1rem;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            flex: 1;
            transition: transform 0.1s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .action-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        
        .btn-yes { background-color: #10b981; color: white; }
        .btn-no { background-color: white; color: #ef4444; border: 2px solid #ef4444; }
        .btn-neutral { background-color: #f1f5f9; color: #475569; }
        .btn-info { background-color: #3b82f6; color: white; }
        .btn-legal { background-color: #6f42c1; color: white; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

    </style>
</head>
<body>

    <div class="main-container">
        
        <div id="dashboard-view">
            <div class="dashboard-header">
                <h1>Suite de Gesti√≥n Integral Diners</h1>
                <p>Seleccione el m√≥dulo de atenci√≥n</p>
            </div>

            <div class="grid-menu">
                <div class="menu-card card-prev" onclick="startScript('preventiva')">
                    <span class="icon">üìÖ</span>
                    <span class="card-title">Actuales Preventivo</span>
                    <span class="card-desc">Antes del vencimiento</span>
                </div>
                <div class="menu-card card-med" onclick="startScript('mora30')">
                    <span class="icon">üü†</span>
                    <span class="card-title">Vencidos / Mora +30</span>
                    <span class="card-desc">Gesti√≥n unificada</span>
                </div>
                <div class="menu-card card-crit" onclick="startScript('mora60')">
                    <span class="icon">üî¥</span>
                    <span class="card-title">Mora +60 / +90</span>
                    <span class="card-desc">Gesti√≥n Cr√≠tica</span>
                </div>
                <div class="menu-card card-refin" onclick="startScript('refinanciamiento')">
                    <span class="icon">üìù</span>
                    <span class="card-title">Refinanciamiento<br>Formalizaci√≥n</span>
                    <span class="card-desc">Legal - Pr√©stamo Personal</span>
                </div>
                <div class="menu-card card-reprog" onclick="startScript('reprogramacion')">
                    <span class="icon">üîÑ</span>
                    <span class="card-title">Reprogramaci√≥n<br>2da Llamada</span>
                    <span class="card-desc">Abono Inicial Realizado</span>
                </div>
            </div>
        </div>

        <div id="script-view">
            <div class="script-top-bar">
                <div class="nav-controls">
                    <button class="btn-nav" onclick="showDashboard()">‚ò∞ Men√∫</button>
                    <button class="btn-nav" id="btn-back" onclick="goBack()">‚¨Ö Atr√°s</button>
                </div>
                <div id="mode-badge" class="mode-badge">MODO</div>
            </div>

            <div class="speech-area">
                <div id="text-display" class="speech-text"></div>
                <div id="note-display" style="display:none;" class="advisor-tip"></div>
            </div>

            <div class="actions-area" id="buttons-display"></div>
        </div>

    </div>

    <script>
        // Inicializaci√≥n segura de datos
        let contractData = {
            refin: {},
            reprog: {}
        };
        
        let currentType = null;
        let currentStepId = 'inicio';
        let historyStack = [];

        // BASE DE DATOS DEL FLUJO
        const db = {
            preventiva: {
                label: "PREVENTIVO", color: "#004b8d", bg: "#e6f0ff",
                steps: {
                    inicio: { text: "Buenos d√≠as/tardes, me comunico con el Sr./Srta. <span class='data-chip'>[SOCIO]</span>.<br><i>(Confirmar que es el socio correcto).</i>", buttons: [{l:"‚úÖ Titular", n:"presentacion", c:"btn-yes"}, {l:"‚ùå No est√°", n:"fin", c:"btn-no"}] },
                    presentacion: { text: "Le saluda <span class='data-chip'>[TU NOMBRE]</span>, en nombre de Diners Club.<br><br>El motivo de nuestra llamada es para recordarle que su estado de cuenta est√° pr√≥ximo a vencer este <span class='data-chip'>[FECHA]</span> por un valor de <span class='data-chip'>[VALOR]</span>.<br><br><b>¬øContamos con su pago para ese d√≠a?</b>", buttons: [{l:"üëç S√≠, pagar√°", n:"promesa", c:"btn-yes"}, {l:"üëé No puede pagar", n:"ofrecer_campana", c:"btn-no"}] },
                    promesa: { text: "Conforme, estimado socio, ¬ønos confirma que el valor de su compromiso es por <span class='data-chip'>[VALOR]</span>?", buttons: [{l:"‚úÖ Total", n:"despedida", c:"btn-yes"}, {l:"üìâ M√≠nimo", n:"pago_minimo", c:"btn-neutral"}] },
                    pago_minimo: { text: "Recuerde que tambi√©n puede realizar el pago m√≠nimo de <span class='data-chip'>[M√çNIMO]</span>.", buttons: [{l:"Continuar", n:"despedida", c:"btn-yes"}] },
                    ofrecer_campana: { text: "¬°Aprovecho para comentarle un gran beneficio!<br>Observo que por campa√±a puede pagar menos al mes trasladando su deuda a cuotas con tasa preferencial.<br><b>¬øDesea la simulaci√≥n?</b>", note: "Campa√±a: ALIVIATE Y/O REGULAR", buttons: [{l:"‚úÖ S√≠, Simular", n:"simulacion", c:"btn-yes"}, {l:"‚ùå No desea", n:"consecuencias", c:"btn-no"}] },
                    simulacion: { text: "<i>(Simular en el mitigador - Generar contrato de voz).</i>", buttons: [{l:"Terminado", n:"despedida", c:"btn-yes"}] },
                    consecuencias: { text: "De acuerdo. Recuerde pagar el m√≠nimo para evitar mora y mantener su r√©cord crediticio.", buttons: [{l:"Finalizar", n:"despedida", c:"btn-neutral"}] },
                    despedida: { text: "Finalmente, recuerde que el cobro de Desgravamen es en d√≥lares (tope USD 6.50). (01) 615.1111 opci√≥n 2.<br>Gracias, mi nombre es <span class='data-chip'>[TU NOMBRE]</span>.", buttons: [{l:"Terminar", n:"inicio", c:"btn-neutral"}] },
                    fin: { text: "Gracias.", buttons: [{l:"Reiniciar", n:"inicio", c:"btn-neutral"}] }
                }
            },
            mora30: {
                label: "MORA +30", color: "#e67e22", bg: "#fff5eb",
                steps: {
                    inicio: { text: "Buenos d√≠as/tardes, me comunico con el Sr./Srta. <span class='data-chip'>[SOCIO]</span>.", buttons: [{l:"‚úÖ Titular", n:"presentacion", c:"btn-yes"}, {l:"‚ùå No est√°", n:"fin", c:"btn-no"}] },
                    presentacion: { text: "Le saluda <span class='data-chip'>[TU NOMBRE]</span>. Tiene una obligaci√≥n pendiente de <span class='data-chip'>[VALOR]</span> con <span class='data-chip'>[D√çAS]</span> de mora.<br><br><span class='highlight-question'>¬øQueremos conocer los motivos de este atraso?</span>", buttons: [{l:"üó£Ô∏è Escuchar Cliente", n:"cobro_posterior", c:"btn-info"}] },
                    cobro_posterior: { text: "Entiendo perfectamente su situaci√≥n. Justamente, para evitar mayores intereses, necesitamos regularizar su tarjeta hoy.<br><b>¬øContamos con su pago?</b>", buttons: [{l:"üëç S√≠, pagar√°", n:"promesa", c:"btn-yes"}, {l:"üëé No paga", n:"ofrecer_campana", c:"btn-no"}] },
                    promesa: { text: "Conforme, ¬øconfirma el pago por <span class='data-chip'>[VALOR]</span>?", buttons: [{l:"‚úÖ Total", n:"cierre_pago_link", c:"btn-yes"}, {l:"üìâ M√≠nimo", n:"pago_minimo", c:"btn-neutral"}] },
                    pago_minimo: { text: "Recuerde que puede pagar el m√≠nimo de <span class='data-chip'>[M√çNIMO]</span>.", buttons: [{l:"Continuar", n:"cierre_pago_link", c:"btn-yes"}] },
                    cierre_pago_link: { text: "Puede pagar en App/Web. <b>üì≤ Le podemos enviar un PAGO LINK por WhatsApp.</b> ¬øQu√© medio prefiere?", buttons: [{l:"Finalizar", n:"despedida", c:"btn-yes"}] },
                    ofrecer_campana: { text: "Diners Club quiere ayudarlo. Tenemos un programa de <b>REPROGRAMACI√ìN</b>.<br><b>¬øDesea simular?</b>", buttons: [{l:"‚úÖ S√≠", n:"simulacion_abono", c:"btn-yes"}, {l:"‚ùå No", n:"consecuencias", c:"btn-no"}] },
                    simulacion_abono: { text: "Para acceder, debe realizar un <b>ABONO INICIAL HOY</b>.<br>¬øEst√° de acuerdo?", buttons: [{l:"‚úÖ De Acuerdo", n:"simulacion_real", c:"btn-yes"}, {l:"‚ùå No tiene abono", n:"consecuencias", c:"btn-no"}] },
                    simulacion_real: { text: "<i>(Generar contrataci√≥n en mitigador).</i>", buttons: [{l:"Ir a Despedida", n:"despedida", c:"btn-yes"}] },
                    consecuencias: { text: "Recuerde que la mora genera bloqueo temporal de tarjeta y reporte negativo.", buttons: [{l:"Finalizar", n:"despedida", c:"btn-neutral"}] },
                    despedida: { text: "Recuerde: Desgravamen en d√≥lares (tope $6.50). Gracias.", buttons: [{l:"Terminar", n:"inicio", c:"btn-neutral"}] },
                    fin: { text: "Gracias.", buttons: [{l:"Reiniciar", n:"inicio", c:"btn-neutral"}] }
                }
            },
            mora60: {
                label: "MORA CR√çTICA", color: "#dc3545", bg: "#fff5f5",
                steps: {
                    inicio: { text: "Buenos d√≠as. Contacto definitivo con <span class='data-chip'>[SOCIO]</span>.", buttons: [{l:"‚úÖ Titular", n:"presentacion", c:"btn-yes"}, {l:"‚ùå No est√°", n:"fin", c:"btn-no"}] },
                    presentacion: { text: "Le saluda <span class='data-chip'>[TU NOMBRE]</span>. Su deuda de <span class='data-chip'>[VALOR]</span> tiene <span class='data-chip'>[D√çAS]</span> de mora. Estamos pr√≥ximos a derivar su caso.<br><br><span class='highlight-question'>¬øQueremos conocer los motivos del incumplimiento?</span>", buttons: [{l:"üó£Ô∏è Escuchar", n:"cobro_posterior", c:"btn-info"}] },
                    cobro_posterior: { text: "Comprendo, pero el sistema exige una soluci√≥n inmediata para detener acciones mayores.<br><b>¬øContamos con su pago total hoy?</b>", buttons: [{l:"üëç Paga", n:"promesa", c:"btn-yes"}, {l:"üëé No paga", n:"ofrecer_campana", c:"btn-no"}] },
                    promesa: { text: "Conforme, ¬øconfirma compromiso por <span class='data-chip'>[VALOR]</span>?", buttons: [{l:"‚úÖ Total", n:"cierre_pago_link", c:"btn-yes"}, {l:"üìâ M√≠nimo", n:"pago_minimo", c:"btn-neutral"}] },
                    pago_minimo: { text: "Recuerde que puede pagar el m√≠nimo.", buttons: [{l:"Continuar", n:"cierre_pago_link", c:"btn-yes"}] },
                    cierre_pago_link: { text: "<b>üì≤ Le podemos enviar un PAGO LINK por WhatsApp.</b> ¬øQu√© medio prefiere?", buttons: [{l:"Finalizar", n:"despedida", c:"btn-yes"}] },
                    ofrecer_campana: { text: "Tenemos un programa de <b>REFINANCIAMIENTO</b>.<br><b>¬øDesea simular?</b>", buttons: [{l:"‚úÖ S√≠", n:"simulacion_abono", c:"btn-yes"}, {l:"‚ùå No", n:"consecuencias", c:"btn-no"}] },
                    simulacion_abono: { text: "Debe realizar un <b>ABONO INICIAL HOY</b>.<br>¬øEst√° de acuerdo?", buttons: [{l:"‚úÖ De Acuerdo", n:"simulacion_real", c:"btn-yes"}, {l:"‚ùå No tiene abono", n:"consecuencias", c:"btn-no"}] },
                    simulacion_real: { text: "<i>(Generar contrataci√≥n).</i>", buttons: [{l:"Ir a Despedida", n:"despedida", c:"btn-yes"}] },
                    consecuencias: { text: "Si cuenta con bloqueo, se desbloquear√° 48h tras el pago.", buttons: [{l:"Finalizar", n:"despedida", c:"btn-neutral"}] },
                    despedida: { text: "Aviso Legal Desgravamen ($6.50). Gracias.", buttons: [{l:"Terminar", n:"inicio", c:"btn-neutral"}] },
                    fin: { text: "Gracias.", buttons: [{l:"Reiniciar", n:"inicio", c:"btn-neutral"}] }
                }
            },
            refinanciamiento: {
                label: "FORMALIZACI√ìN REFIN.", color: "#00897b", bg: "#e0f2f1",
                steps: {
                    inicio: { text: "Buenos d√≠as/tardes. Le saluda <span class='data-chip'>[TU NOMBRE]</span> de Diners Club.<br>Comentarle que ya se hizo efectivo su pago inicial y generaremos la solicitud de refinanciamiento.", buttons: [{l:"‚úÖ Socio Conforme", n:"validacion_identidad", c:"btn-yes"}, {l:"‚ùå No Conforme", n:"repetir_simulacion", c:"btn-no"}] },
                    repetir_simulacion: { text: "<i>(Repetir la simulaci√≥n con nueva oferta).</i>", buttons: [{l:"Volver", n:"inicio", c:"btn-neutral"}] },
                    validacion_identidad: { text: "Debemos confirmar su identidad. La llamada est√° siendo grabada.<br>1. ¬øNombres completos?<br>2. ¬øDNI?<br>3. ¬øFecha de nacimiento?", buttons: [{l:"‚úÖ Validaci√≥n Exitosa", n:"toma_datos", c:"btn-yes"}, {l:"‚ùå No valida", n:"fin_validacion", c:"btn-no"}] },
                    toma_datos: { text: "Confirme sus datos:<br><div class='form-grid'><div class='form-item'><label>Direcci√≥n:</label><input class='speech-input'></div><div class='form-item'><label>Correo:</label><input class='speech-input'></div><div class='form-item'><label>Tel√©fono:</label><input class='speech-input'></div><div class='form-item'><label>Ingresos:</label><input class='speech-input'></div></div>", buttons: [{l:"Datos Completos", n:"simulacion_info", c:"btn-yes"}] },
                    simulacion_info: { text: "Procederemos con la SIMULACI√ìN.<br>El refinanciamiento ser√° un <b>Pr√©stamo Personal Banco Pichincha</b>.<br>¬øCu√°ntos meses desea?", buttons: [{l:"Continuar", n:"condiciones", c:"btn-yes"}] },
                    condiciones: { text: "<b>Condiciones:</b><br>1. Tarjeta cancelada.<br>2. P√©rdida de millas.<br>3. Reclasificaci√≥n financiera.<br>4. Pagos en ventanillas Pichincha.<br><br>¬øEst√° de acuerdo?", buttons: [{l:"‚úÖ S√ç, ACEPTO", n:"config_contrato_refin", c:"btn-yes"}] },
                    config_contrato_refin: { text: "<b>DATOS PARA CONTRATO:</b><br><div class='form-grid'><div class='form-item'><label>Monto (S/):</label><input id='in_monto' class='speech-input'></div><div class='form-item'><label>Plazo (Meses):</label><input id='in_plazo' class='speech-input'></div><div class='form-item'><label>TEA (%):</label><input id='in_tea' class='speech-input'></div><div class='form-item'><label>Cuota (S/):</label><input id='in_cuota' class='speech-input'></div><div class='form-item'><label>1ra Fecha:</label><input id='in_fecha' class='speech-input'></div></div>", buttons: [{l:"üìÑ Generar Script", n:"lectura_contrato_refin", c:"btn-legal"}] },
                    lectura_contrato_refin: { text: "TEXTO DIN√ÅMICO REFINANCIAMIENTO", buttons: [{l:"‚úÖ S√ç, ACEPTO", n:"cierre_legal", c:"btn-yes"}, {l:"‚ùå NO ACEPTA", n:"fin", c:"btn-no"}] },
                    cierre_legal: { text: "Recibir√° la documentaci√≥n en su correo en 15 d√≠as. La grabaci√≥n pasar√° validaci√≥n.<br>¬°Gracias!", buttons: [{l:"Finalizar", n:"inicio", c:"btn-neutral"}] },
                    fin_validacion: { text: "No se puede continuar sin validaci√≥n.", buttons: [{l:"Reiniciar", n:"inicio", c:"btn-neutral"}] },
                    fin: { text: "Gesti√≥n terminada.", buttons: [{l:"Reiniciar", n:"inicio", c:"btn-neutral"}] }
                }
            },
            reprogramacion: {
                label: "REPROGRAMACI√ìN", color: "#6f42c1", bg: "#f3e5f5",
                steps: {
                    inicio: { text: "Buenos d√≠as/tardes, me comunico con el Sr./Srta. <span class='data-chip'>[SOCIO]</span>.<br>Le saluda <span class='data-chip'>[TU NOMBRE]</span>.<br><b>Comentarle que ya se hizo efectivo el pago inicial y generaremos la reprogramaci√≥n.</b>", note: "Simular e informar.", buttons: [{l:"‚úÖ Socio Conforme", n:"validacion", c:"btn-yes"}, {l:"‚ùå No Conforme", n:"resimular", c:"btn-no"}, {l:"üí° Ver Beneficios", n:"beneficios", c:"btn-info"}] },
                    resimular: { text: "Entiendo. Vamos a repetir la simulaci√≥n con una nueva oferta.", buttons: [{l:"Volver", n:"inicio", c:"btn-neutral"}, {l:"üì¢ Urgencia", n:"urgencia", c:"btn-info"}] },
                    urgencia: { text: "Esta oferta est√° vigente por <b>3 d√≠as</b>. Si paga solo m√≠nimos, pagar√° mucho m√°s en intereses.", buttons: [{l:"Volver a Oferta", n:"inicio", c:"btn-neutral"}] },
                    beneficios: { text: "<b>Beneficios:</b><br>‚Ä¢ Evita intereses moratorios.<br>‚Ä¢ Cuota adecuada.<br>‚Ä¢ Evita reporte negativo en centrales.<br>‚Ä¢ Reduce estr√©s financiero.", buttons: [{l:"Volver", n:"inicio", c:"btn-neutral"}] },
                    validacion: { text: "Debemos confirmar identidad (Llamada Grabada).<br>1. Nombres completos.<br>2. DNI.<br>3. Fecha de nacimiento.", buttons: [{l:"‚úÖ Validaci√≥n OK", n:"toma_datos", c:"btn-yes"}, {l:"‚ùå Fall√≥", n:"fin_validacion", c:"btn-no"}] },
                    toma_datos: { text: "Confirme datos para titularidad:<br><div class='form-grid'><div class='form-item'><label>Direcci√≥n:</label><input class='speech-input'></div><div class='form-item'><label>Correo:</label><input class='speech-input'></div><div class='form-item'><label>Ingresos:</label><input class='speech-input'></div><div class='form-item'><label>Laboral:</label><select class='speech-input'><option>Dependiente</option><option>Independiente</option></select></div></div>", buttons: [{l:"Datos Completos", n:"condiciones_previas", c:"btn-yes"}] },
                    condiciones_previas: { text: "<b>Condiciones:</b><br><ul><li>Deuda total: [SOL] y [DOL].</li><li>Tasa TEA: 33.99%.</li><li>Plazo: 48 cuotas.</li><li>Posible reducci√≥n de l√≠nea.</li></ul><br>Pasaremos a la lectura del acuerdo.", buttons: [{l:"‚û°Ô∏è Ir a Lectura", n:"config_contrato_reprog", c:"btn-yes"}] },
                    config_contrato_reprog: { text: "<b>DATOS PARA CONTRATO:</b><br><div class='form-grid'><div class='form-item'><label>Monto (S/):</label><input id='rep_monto' class='speech-input'></div><div class='form-item'><label>Plazo:</label><input id='rep_plazo' class='speech-input' value='48'></div><div class='form-item'><label>TEA (%):</label><input id='rep_tea' class='speech-input' value='33.99'></div><div class='form-item'><label>1ra Fecha:</label><input id='rep_fecha' class='speech-input'></div></div>", buttons: [{l:"üìÑ Generar Script", n:"lectura_contrato_reprog", c:"btn-legal"}] },
                    lectura_contrato_reprog: { text: "TEXTO DIN√ÅMICO REPROGRAMACI√ìN", buttons: [{l:"‚úÖ S√ç ACEPTO", n:"cierre_reprog", c:"btn-yes"}, {l:"‚ùå NO", n:"resimular", c:"btn-no"}] },
                    cierre_reprog: { text: "Todo el detalle lo visualizar√° en su pr√≥ximo estado de cuenta.<br>¬°Gracias por reafirmar su compromiso!", buttons: [{l:"Finalizar", n:"inicio", c:"btn-neutral"}] },
                    fin_validacion: { text: "No se puede continuar sin validaci√≥n.", buttons: [{l:"Reiniciar", n:"inicio", c:"btn-neutral"}] }
                }
            }
        };

        // --- FUNCIONES ---
        function startScript(type) {
            currentType = type;
            currentStepId = 'inicio';
            historyStack = [];
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('script-view').style.display = 'flex';
            updateBadge();
            render();
        }

        function updateBadge() {
            const config = db[currentType];
            const badge = document.getElementById('mode-badge');
            badge.innerText = config.label;
            badge.style.backgroundColor = config.bg;
            badge.style.color = config.color;
            badge.style.border = `1px solid ${config.color}`;
        }

        function render() {
            const stepData = db[currentType].steps[currentStepId];
            const textDisplay = document.getElementById('text-display');

            // L√≥gica para textos din√°micos
            if (currentStepId === 'lectura_contrato_refin') {
                textDisplay.innerHTML = generateRefinContract();
            } else if (currentStepId === 'lectura_contrato_reprog') {
                textDisplay.innerHTML = generateReprogContract();
            } else {
                textDisplay.innerHTML = stepData.text;
            }

            // Notas
            const noteDiv = document.getElementById('note-display');
            if (stepData.note) {
                noteDiv.innerHTML = "üí° " + stepData.note;
                noteDiv.style.display = 'inline-block';
            } else {
                noteDiv.style.display = 'none';
            }

            // Botones
            const btnContainer = document.getElementById('buttons-display');
            btnContainer.innerHTML = '';
            stepData.buttons.forEach(btn => {
                const button = document.createElement('button');
                button.innerHTML = btn.l;
                button.className = `action-btn ${btn.c}`;
                button.onclick = () => {
                    // Guardar datos
                    if(currentStepId === 'config_contrato_refin') saveRefinData();
                    if(currentStepId === 'config_contrato_reprog') saveReprogData();
                    
                    // Navegar
                    if(btn.n === 'inicio') {
                        historyStack = [];
                        currentStepId = 'inicio';
                    } else {
                        historyStack.push(currentStepId);
                        currentStepId = btn.n;
                    }
                    render();
                };
                btnContainer.appendChild(button);
            });

            updateBackBtn();
        }

        // --- L√ìGICA DE CONTRATOS ---
        function saveRefinData() {
            contractData.refin = {
                monto: document.getElementById('in_monto').value || '[MONTO]',
                plazo: document.getElementById('in_plazo').value || '[PLAZO]',
                tea: document.getElementById('in_tea').value || '[TEA]',
                cuota: document.getElementById('in_cuota').value || '[CUOTA]',
                fecha: document.getElementById('in_fecha').value || '[FECHA]'
            };
        }

        function generateRefinContract() {
            const d = contractData.refin || {};
            return `Por √∫ltimo, vamos a iniciar con el Contrato de voz. Responda con "S√≠, Acepto".<br><br>¬øEst√° de acuerdo con las condiciones de su nuevo Pr√©stamo Personal bajo la modalidad de refinanciaci√≥n, por un monto de <span class='data-chip'>S/ ${d.monto}</span> a un plazo de <span class='data-chip'>${d.plazo} MESES</span>, con una TEA de <span class='data-chip'>${d.tea}%</span> donde su primera cuota ser√° el d√≠a <span class='data-chip'>${d.fecha}</span> por <span class='data-chip'>S/ ${d.cuota}</span>?`;
        }

        function saveReprogData() {
            contractData.reprog = {
                monto: document.getElementById('rep_monto').value || '[MONTO]',
                plazo: document.getElementById('rep_plazo').value || '48',
                tea: document.getElementById('rep_tea').value || '33.99',
                fecha: document.getElementById('rep_fecha').value || '[FECHA]'
            };
        }

        function generateReprogContract() {
            const d = contractData.reprog || {};
            return `Para TERMINAR, leer√© el acuerdo.<br><br>Se√±or(a), ¬øEst√° usted de acuerdo en reprogramar la deuda de su Tarjeta Diners Club por un monto de <span class='data-chip'>S/ ${d.monto}</span> a financiar en <span class='data-chip'>${d.plazo} cuotas</span>, con una TEA de <span class='data-chip'>${d.tea}%</span>? La primera cuota ser√° el <span class='data-chip'>${d.fecha}</span>.<br><br>Indique si est√° de acuerdo con: <b>S√ç ACEPTO</b> o <b>CONFORME</b>.`;
        }

        // --- NAVEGACI√ìN ---
        function goBack() {
            if (historyStack.length > 0) {
                currentStepId = historyStack.pop();
                render();
            }
        }
        function updateBackBtn() {
            const btn = document.getElementById('btn-back');
            btn.classList.toggle('disabled', historyStack.length === 0);
            btn.disabled = historyStack.length === 0;
        }
        function showDashboard() {
            document.getElementById('script-view').style.display = 'none';
            document.getElementById('dashboard-view').style.display = 'flex';
        }
    </script>
</body>
</html>